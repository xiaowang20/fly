<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wg.pms.dao.EmployeeDao">
    <resultMap id="BaseResultMap" type="com.wg.pms.entity.Employee">
        <id column="id" jdbcType="INTEGER" property="id" />
        <result column="name" jdbcType="VARCHAR" property="name" />
        <result column="gender" jdbcType="CHAR" property="gender" />
        <result column="birthday" jdbcType="DATE" property="birthday" />
        <result column="idCard" jdbcType="CHAR" property="idcard" />
        <result column="wedlock" jdbcType="CHAR" property="wedlock" />
        <result column="nationId" jdbcType="INTEGER" property="nationid" />
        <result column="nativePlace" jdbcType="VARCHAR" property="nativeplace" />
        <result column="politicId" jdbcType="INTEGER" property="politicid" />
        <result column="email" jdbcType="VARCHAR" property="email" />
        <result column="phone" jdbcType="VARCHAR" property="phone" />
        <result column="address" jdbcType="VARCHAR" property="address" />
        <result column="departmentId" jdbcType="INTEGER" property="departmentid" />
        <result column="jobLevelId" jdbcType="INTEGER" property="joblevelid" />
        <result column="posId" jdbcType="INTEGER" property="posid" />
        <result column="engageForm" jdbcType="VARCHAR" property="engageform" />
        <result column="tiptopDegree" jdbcType="CHAR" property="tiptopdegree" />
        <result column="specialty" jdbcType="VARCHAR" property="specialty" />
        <result column="school" jdbcType="VARCHAR" property="school" />
        <result column="beginDate" jdbcType="DATE" property="begindate" />
        <result column="workState" jdbcType="CHAR" property="workstate" />
        <result column="workID" jdbcType="CHAR" property="workid" />
        <result column="contractTerm" jdbcType="DOUBLE" property="contractterm" />
        <result column="conversionTime" jdbcType="DATE" property="conversiontime" />
        <result column="notWorkDate" jdbcType="DATE" property="notworkdate" />
        <result column="beginContract" jdbcType="DATE" property="begincontract" />
        <result column="endContract" jdbcType="DATE" property="endcontract" />
        <result column="workAge" jdbcType="INTEGER" property="workage" />
        <collection property="politicsstatus" javaType="com.wg.pms.entity.Politicsstatus" columnPrefix="polsta_">
            <result column="id" property="id" jdbcType="INTEGER"/>
            <result column="name" property="name" jdbcType="VARCHAR"/>
        </collection>
        <collection property="nation" javaType="com.wg.pms.entity.Nation" columnPrefix="nat_">
            <result column="id" jdbcType="INTEGER" property="id" />
            <result column="name" jdbcType="VARCHAR" property="name" />
        </collection>
        <collection property="department" javaType="com.wg.pms.entity.Department" columnPrefix="dep_">
            <result column="id" jdbcType="INTEGER" property="id" />
            <result column="name" jdbcType="VARCHAR" property="name" />
        </collection>
        <collection property="joblevel" javaType="com.wg.pms.entity.Joblevel" columnPrefix="job_" >
            <result column="id" jdbcType="INTEGER" property="id" />
            <result column="name" jdbcType="VARCHAR" property="name" />
        </collection>
        <collection property="position" javaType="com.wg.pms.entity.Position" columnPrefix="posi_">
            <result column="id"  jdbcType="INTEGER" property="id" />
            <result column="name" jdbcType="VARCHAR" property="name" />
        </collection>
    </resultMap>
    <select id="getAllEmp" resultMap="BaseResultMap" resultType="Long">
        SELECT e.*,
        p.`id` polsta_id,p.`name` polsta_name,
        n.`id` nat_id,n.`name` nat_name,
        d.`id` dep_id,d.`name` dep_name,
        j.`id` job_id,j.`name` job_name,
        pos.`id` posi_id,pos.`name` posi_name
        FROM employee e
        LEFT JOIN nation n ON e.nationId = n.id
        LEFT JOIN politicsstatus p ON e.politicId = p.id
        LEFT JOIN department d ON e.departmentId = d.id
        LEFT JOIN joblevel j ON e.jobLevelId= j.id
        LEFT JOIN POSITION pos  ON e.posId= pos.id

        <where>
            <choose>
                <when test="keyword != null and keyword != ''">
                    and e.name like concat('%',#{keyword},'%')
                </when>
                <otherwise>
                    and #{keyword} is null or '' = #{keyword}
                </otherwise>

            </choose>
        </where>

    </select>


    <select id="list" resultMap="BaseResultMap">
        SELECT e.*,
        p.`id` polsta_id,p.`name` polsta_name,
        n.`id` nat_id,n.`name` nat_name,
        d.`id` dep_id,d.`name` dep_name,
        j.`id` job_id,j.`name` job_name,
        pos.`id` posi_id,pos.`name` posi_name
        FROM employee e
        LEFT JOIN nation n ON e.nationId = n.id
        LEFT JOIN politicsstatus p ON e.politicId = p.id
        LEFT JOIN department d ON e.departmentId = d.id
        LEFT JOIN joblevel j ON e.jobLevelId= j.id
        LEFT JOIN POSITION pos  ON e.posId= pos.id
        <where>
            <choose>
                <when test="name != null and name != ''">
                    and e.name like concat('%',#{name},'%')
                </when>
                <otherwise>
                    and #{name} is null or '' = #{name}
                </otherwise>
            </choose>
            <choose>
                <when test="politicId !=null and politicId != 0">
                    and e.politicId =#{politicId}
                </when>
                <otherwise>
                    and #{politicId} is null or 0 = #{politicId}
                </otherwise>
            </choose>
            <choose>
                <when test="nationId !=null and nationId != 0">
                    and e.nationId =#{nationId}
                </when>
                <otherwise>
                    and #{nationId} is null or 0 = #{nationId}
                </otherwise>
            </choose>
            <choose>
                <when test="departmentId !=null and departmentId != 0">
                    and e.departmentId =#{departmentId}
                </when>
                <otherwise>
                    and #{departmentId} is null or 0 = #{departmentId}
                </otherwise>
            </choose>
            <choose>
                <when test="jobLevelId !=null and jobLevelId != 0">
                    and e.jobLevelId =#{jobLevelId}
                </when>
                <otherwise>
                    and #{jobLevelId} is null or 0 = #{jobLevelId}
                </otherwise>
            </choose>
            <choose>
                <when test="engageForm !=null and engageForm != ''">
                    and e.engageForm =#{emp.engageForm}
                </when>
                <otherwise>
                    and #{engageForm} is null or '' = #{engageForm}
                </otherwise>
            </choose>
            <choose>
                <when test="positionId !=null and positionId != 0">
                    and e.posId =#{positionId}
                </when>
                <otherwise>
                    and #{positionId} is null or 0 = #{positionId}
                </otherwise>
            </choose>
        </where>
    </select>
    <select id="getByPrimaryKey" resultMap="BaseResultMap">
        SELECT e.*,
        p.`id` polsta_id,p.`name` polsta_name,
        n.`id` nat_id,n.`name` nat_name,
        d.`id` dep_id,d.`name` dep_name,
        j.`id` job_id,j.`name` job_name,
        pos.`id` posi_id,pos.`name` posi_name
        FROM employee e
        LEFT JOIN nation n ON e.nationId = n.id
        LEFT JOIN politicsstatus p ON e.politicId = p.id
        LEFT JOIN department d ON e.departmentId = d.id
        LEFT JOIN joblevel j ON e.jobLevelId= j.id
        LEFT JOIN POSITION pos  ON e.posId= pos.id
        where e.id = #{id}
    </select>
    <insert id="addEmps">
        insert into employee (name, gender,
        birthday, idCard, wedlock, nationId,
        nativePlace, politicId, email,
        phone, address, departmentId,
        jobLevelId, posId, engageForm,
        tiptopDegree, specialty, school,
        beginDate, workState, workID,
        contractTerm, conversionTime, notWorkDate,
        beginContract, endContract, workAge
        )
        values
        <foreach collection="list" separator="," item="emp">
            (#{emp.name,jdbcType=VARCHAR}, #{emp.gender,jdbcType=CHAR},
            #{emp.birthday,jdbcType=DATE}, #{emp.idCard,jdbcType=CHAR}, #{emp.wedlock,jdbcType=CHAR},
            #{emp.nationId,jdbcType=INTEGER},
            #{emp.nativePlace,jdbcType=VARCHAR}, #{emp.politicId,jdbcType=INTEGER}, #{emp.email,jdbcType=VARCHAR},
            #{emp.phone,jdbcType=VARCHAR}, #{emp.address,jdbcType=VARCHAR}, #{emp.departmentId,jdbcType=INTEGER},
            #{emp.jobLevelId,jdbcType=INTEGER}, #{emp.posId,jdbcType=INTEGER}, #{emp.engageForm,jdbcType=VARCHAR},
            #{emp.tiptopDegree,jdbcType=CHAR}, #{emp.specialty,jdbcType=VARCHAR}, #{emp.school,jdbcType=VARCHAR},
            #{emp.beginDate,jdbcType=DATE}, #{emp.workState,jdbcType=CHAR}, #{emp.workID,jdbcType=CHAR},
            #{emp.contractTerm,jdbcType=DOUBLE}, #{emp.conversionTime,jdbcType=DATE}, #{emp.notWorkDate,jdbcType=DATE},
            #{emp.beginContract,jdbcType=DATE}, #{emp.endContract,jdbcType=DATE}, #{emp.workAge,jdbcType=INTEGER}
            )
        </foreach>
    </insert>
</mapper>